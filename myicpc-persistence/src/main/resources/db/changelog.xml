<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="1" author="smetana">
        <dropUniqueConstraint tableName="university" constraintName="uk_h8vncdlyoa4j8mipwx022ir16" />
        <addColumn tableName="university">
            <column name="externalunitid" type="bigint">
                <constraints unique="true" />
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="2" author="smetana">
        <addColumn tableName="contestparticipantassociation">
            <column name="contestid" type="bigint">
                <constraints nullable="false" />
            </column>
        </addColumn>
        <addForeignKeyConstraint baseTableName="contestparticipantassociation" baseColumnNames="contestid"
                                 referencedTableName="contest" referencedColumnNames="id"
                                 constraintName="fk_contestparticipantassociation_contest" />
    </changeSet>
    
    <changeSet id="3" author="smetana">
        <dropUniqueConstraint tableName="questparticipant" constraintName="uk_lpens92jo6x8jttnv4dauq7yq" />
        <addUniqueConstraint tableName="questparticipant" columnNames="contestparticipantid, contestid" />
    </changeSet>

    <changeSet id="4" author="smetana">
        <addColumn tableName="contest">
            <column name="hidden" type="boolean" defaultValue="false">
                <constraints nullable="false" />
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="5" author="smetana">
        <addColumn tableName="moduleconfiguration">
            <column name="officialgallerymodule" type="boolean" defaultValue="false">
                <constraints nullable="false" />
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="6" author="smetana">
        <addColumn tableName="region">
            <column name="regiontype" type="varchar(20)" defaultValue="NORMAL" />
        </addColumn>
    </changeSet>

    <changeSet id="7" author="smetana">
        <addColumn tableName="language">
            <column name="contestid" type="bigint" defaultValue="1">
                <constraints nullable="false" />
            </column>
        </addColumn>
        <dropUniqueConstraint tableName="language" constraintName="uk_nk4c9qcgv8el6abqd6etg77yy" />
        <addUniqueConstraint tableName="language" columnNames="name, contestid" />
        <addForeignKeyConstraint baseTableName="language"
                                 baseColumnNames="contestid"
                                 constraintName="fk_language_contest"
                                 referencedTableName="contest"
                                 referencedColumnNames="id" />
    </changeSet>

    <changeSet id="8" author="smetana">
        <sql>
            CREATE TABLE judgementcolor (
                id bigint NOT NULL,
                code character varying(255),
                color character varying(255),
                contestid bigint NOT NULL
            );

            ALTER TABLE public.judgementcolor OWNER TO myicpc;

            CREATE SEQUENCE judgementcolor_id_seq
                START WITH 1
                INCREMENT BY 1
                NO MINVALUE
                NO MAXVALUE
                CACHE 1;

            ALTER TABLE public.judgementcolor_id_seq OWNER TO myicpc;

            ALTER TABLE ONLY judgementcolor
                ADD CONSTRAINT judgementcolor_pkey PRIMARY KEY (id);

            ALTER TABLE ONLY judgementcolor
                ADD CONSTRAINT code_contestid_key UNIQUE (code, contestid);

            ALTER TABLE ONLY judgementcolor
                ADD CONSTRAINT fk_judgementcolor_contest FOREIGN KEY (contestid) REFERENCES contest(id);
        </sql>
    </changeSet>

</databaseChangeLog>