// Generated by CoffeeScript 1.8.0
var insightApp;

insightApp = angular.module('insight', ['ngRoute', 'nvd3ChartDirectives']);

insightApp.config([
  '$routeProvider', function($routeProvider) {
    return $routeProvider.when('/problems', {
      templateUrl: 'insight/template/all-problems',
      controller: 'allProblemsCtrl'
    }).when('/problem/:problemCode', {
      templateUrl: 'insight/template/problem-detail',
      controller: 'problemDetailCtrl'
    }).when('/languages', {
      templateUrl: 'insight/template/all-languages',
      controller: 'allLanguagesCtrl'
    }).when('/language/:languageName', {
      templateUrl: 'insight/template/language-detail',
      controller: 'languageDetailCtrl'
    }).when('/code', {
      templateUrl: 'insight/template/code-insight',
      controller: 'codeInsightCtrl'
    }).otherwise({
      redirectTo: '/problems'
    });
  }
]);

insightApp.factory('insightService', function() {
  var insightService;
  insightService = {};
  insightService.xFunction = function() {
    return function(d) {
      return d.key;
    };
  };
  insightService.yFunction = function() {
    return function(d) {
      return d.value;
    };
  };
  insightService.areaColor = function() {
    return function(d, i) {
      return d.data.color;
    };
  };
  insightService.toolTipContentFunction = function() {
    return function(key, x, y, e, graph) {
      return '<p><strong>' + key + '</strong>' + ' - ' + Math.round(x) + ' submissions</p>';
    };
  };
  return insightService;
});

insightApp.controller('allProblemsCtrl', function($scope, $http, insightService) {
  $scope.data = null;
  $scope.problems = [];
  $scope.init = function(contextPath, contestCode, title) {
    $("#insightHeadline").html("" + title);
    return $http.get("" + contextPath + "/" + contestCode + "/insight/ajax/all-problems").success(function(data) {
      $scope.data = data.data;
      $scope.problems = data.problems;
      return $("#insightHeadline").html(data.title);
    }).error(function() {});
  };
  $scope.xFunction = insightService.xFunction;
  $scope.yFunction = insightService.yFunction;
  $scope.areaColor = insightService.areaColor;
  return $scope.toolTipContentFunction = insightService.toolTipContentFunction;
});

insightApp.controller('problemDetailCtrl', function($scope, $http, $routeParams, insightService) {
  $scope.data = null;
  $scope.init = function(contextPath, contestCode, title) {
    $("#insightHeadline").html("" + title + " " + $routeParams.problemCode);
    return $http.get("" + contextPath + "/" + contestCode + "/insight/ajax/problem/" + $routeParams.problemCode).success(function(data) {
      console.log(data);
      $scope.data = data.data;
      return $("#insightHeadline").html(data.title);
    }).error(function() {});
  };
  $scope.xFunction = insightService.xFunction;
  $scope.yFunction = insightService.yFunction;
  $scope.areaColor = insightService.areaColor;
  return $scope.toolTipContentFunction = insightService.toolTipContentFunction;
});

insightApp.controller('allLanguagesCtrl', function($scope, $http, insightService) {
  $scope.data = null;
  return $scope.init = function(contextPath, contestCode, title) {
    $("#insightHeadline").html("" + title);
    return $http.get("" + contextPath + "/" + contestCode + "/insight/ajax/all-languages").success(function(data) {
      $scope.data = data.data;
      return $("#insightHeadline").html(data.title);
    }).error(function() {});
  };
});

insightApp.controller('languageDetailCtrl', function($scope, $http, $routeParams, insightService) {
  $scope.data = null;
  $scope.languageName = $routeParams.languageName;
  $scope.init = function(contextPath, contestCode, title) {
    $("#insightHeadline").html("" + title + " " + $routeParams.languageName);
    return $http.get("" + contextPath + "/" + contestCode + "/insight/ajax/language/" + $routeParams.languageName).success(function(data) {
      console.log(data);
      $scope.data = data.data;
      return $("#insightHeadline").html(data.title);
    }).error(function() {});
  };
  $scope.xFunction = insightService.xFunction;
  $scope.yFunction = insightService.yFunction;
  $scope.areaColor = insightService.areaColor;
  return $scope.toolTipContentFunction = insightService.toolTipContentFunction;
});

insightApp.controller('codeInsightCtrl', function($scope, $http) {
  $scope.data = null;
  return $scope.init = function(contextPath, contestCode, title) {
    return $("#insightHeadline").html("" + title);
  };
});
